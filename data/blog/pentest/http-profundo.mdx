---
title: 'HTTP profundo (headers, m√©todos, status)'
date: '2025-12-31'
tags: ['Http', 'Pentest', 'Base']
draft: false
summary: 'Estudo detalhado dos headers, m√©todos e status codes do protocolo HTTP.'
---

#  HTTP profundo (headers, m√©todos, status)

O protocolo HTTP (Hypertext Transfer Protocol) √© a base da comunica√ß√£o na web. Ele define como as mensagens s√£o formatadas e transmitidas entre clientes (como navegadores) e servidores. Neste artigo, vamos explorar em detalhes os headers, m√©todos e status codes do HTTP, que s√£o componentes essenciais para entender como a web funciona.

## Headers

### Strict-Transport-Security (HSTS)
O header Strict-Transport-Security (HSTS) √© uma medida de seguran√ßa que instrui os navegadores a se comunicarem apenas por meio de conex√µes HTTPS seguras. Ele ajuda a prevenir ataques de downgrade e sequestro de cookies, garantindo que todas as comunica√ß√µes futuras com o servidor sejam feitas de forma segura.

`max-age=3153600` - Define o tempo em segundos que o navegador deve lembrar de usar HTTPS (neste caso, 1 hora).

`includeSubDomains` - Aplica a pol√≠tica HSTS a todos os subdom√≠nios do dom√≠nio principal.
preload - Indica que o dom√≠nio deve ser inclu√≠do na lista de pr√©-carregamento HSTS mantida pelos navegadores.

`x-frame-options(obsoleto)` - O header X-Frame-Options √© usado para proteger contra ataques de clickjacking, controlando se uma p√°gina pode ser incorporada em um iframe. Ele pode ter os seguintes valores:

  DENY - Impede que a p√°gina seja carregada em qualquer iframe.
  SAMEORIGIN - Permite que a p√°gina seja carregada em iframes apenas do mesmo dom√≠nio.
  ALLOW-FROM uri - Permite que a p√°gina seja carregada em iframes de um URI espec√≠fico.

`content-security-policy` - O header Content-Security-Policy (CSP) √© uma medida de seguran√ßa que ajuda a prevenir ataques de inje√ß√£o de c√≥digo, como Cross-Site Scripting (XSS). Ele permite que os administradores definam pol√≠ticas de seguran√ßa para controlar quais recursos podem ser carregados e executados em uma p√°gina web.

### X-Content-Type-Options

Content-Type-Options - Define como o navegador deve interpretar os tipos de conte√∫do recebidos do servidor.

O header X-Content-Type-Options √© usado para evitar que os navegadores fa√ßam "sniffing" do tipo de conte√∫do, o que pode levar a vulnerabilidades de seguran√ßa. O valor mais comum para este header √© "nosniff", que instrui o navegador a seguir estritamente o tipo de conte√∫do declarado no header Content-Type.

Options: 
  nosniff - Instruir o navegador a n√£o fazer "sniffing" do tipo de conte√∫do.

### Content-Security-Policy (CSP)

O header Content-Security-Policy (CSP) √© uma medida de seguran√ßa que ajuda a prevenir ataques de inje√ß√£o de c√≥digo, como Cross-Site Scripting (XSS). Ele permite que os administradores definam pol√≠ticas de seguran√ßa para controlar quais recursos podem ser carregados e executados em uma p√°gina web.

Valor default:
  default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; frame-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';

### Exemplo

```.java
.headers(headers -> headers
    .contentSecurityPolicy(csp -> csp
        .policyDirectives(
            "default-src 'self'; " +
            "script-src 'self'; " +
            "style-src 'self'; " +
            "img-src 'self' data:; " +
            "font-src 'self'; " +
            "connect-src 'self'; " +
            "frame-ancestors 'none'; " +
            "object-src 'none'; " +
            "base-uri 'self'; " +
            "form-action 'self'"
        )
    )
)
```

üî¥ Alerta de pentest
Uso de:

'unsafe-inline'
'unsafe-eval'


‚Üí abre vetor direto para XSS
Isso vira finding de severidade alta em relat√≥rio.

### Referrer-Policy

O header Referrer-Policy controla como e quando o navegador deve enviar informa√ß√µes de refer√™ncia (referrer) ao fazer solicita√ß√µes para outros sites. Ele ajuda a proteger a privacidade do usu√°rio, limitando a quantidade de informa√ß√µes compartilhadas entre sites. 

Valor default:
  no-referrer
  no-referrer-when-downgrade
  same-origin
  origin
  strict-origin
  origin-when-cross-origin
  unsafe-url

### Fallback-policy

O header Fallback-policy √© usado para definir pol√≠ticas de fallback para recursos que n√£o podem ser carregados corretamente. Ele ajuda a garantir que, mesmo que um recurso espec√≠fico n√£o esteja dispon√≠vel, o site ainda possa funcionar de maneira adequada, fornecendo alternativas ou comportamentos padr√£o.

Valor default:
  strinck-origin
  same-origin
  no-referrer

### Clear-Site-Data

O header Clear-Site-Data √© usado para instruir o navegador a limpar dados espec√≠ficos relacionados ao site atual. Ele pode ser usado para melhorar a privacidade do usu√°rio, removendo informa√ß√µes armazenadas localmente, como cookies, cache e armazenamento local.

Valor default:
  "cache", "cookies", "storage", "executionContexts", "indexedDB", "localstorage"

### Cache-Control

O header Cache-Control √© usado para definir pol√≠ticas de cache para recursos web. Ele instrui os navegadores e proxies sobre como armazenar e reutilizar recursos, ajudando a melhorar o desempenho e a efici√™ncia do carregamento de p√°ginas.

Valor default:
  no-cache - Indica que a resposta n√£o deve ser armazenada em cache.
  no-store - Indica que a resposta n√£o deve ser armazenada em cache de forma alguma.
  max-age=0 - Indica que a resposta √© considerada imediatamente obsoleta.
  public - Indica que a resposta pode ser armazenada em cache por qualquer cache, mesmo que seja compartilhado.
  expires - Define uma data e hora espec√≠ficas em que a resposta expira e n√£o deve mais ser considerada v√°lida.
  pragma - Usado para compatibilidade com HTTP/1.0, geralmente definido como "no-cache".

```.java
@GetMapping("/user/profile")
public ResponseEntity<UserDTO> profile() {
    return ResponseEntity.ok()
        .header("Cache-Control", "no-store, no-cache, must-revalidate, max-age=0")
        .header("Pragma", "no-cache")
        .body(userService.getProfile());
}
```
üîé Pentest insight
Tokens JWT ou dados pessoais com cache habilitado = vulnerabilidade de privacidade.

### Set-cookies

O header Set-Cookie √© usado pelo servidor para enviar cookies ao navegador do cliente. Cookies s√£o pequenos peda√ßos de dados que s√£o armazenados no navegador e enviados de volta ao servidor em solicita√ß√µes subsequentes. Eles s√£o usados para manter sess√µes, rastrear usu√°rios e armazenar prefer√™ncias.

Propriedades comuns:
  Expires - Define a data e hora em que o cookie expira.
  Max-Age - Define o tempo em segundos at√© o cookie expirar.
  Domain - Especifica o dom√≠nio para o qual o cookie √© v√°lido.
  Path - Define o caminho no servidor para o qual o cookie √© v√°lido.
  Secure - Indica que o cookie deve ser enviado apenas por conex√µes HTTPS.
  HttpOnly - Indica que o cookie n√£o deve ser acess√≠vel via JavaScript, ajudando a prevenir ataques XSS.
  SameSite - Controla se o cookie deve ser enviado em solicita√ß√µes de terceiros, ajudando a prevenir ataques CSRF. Pode ter os valores "Strict", "Lax" ou "None".

```.java
ResponseCookie cookie = ResponseCookie.from("SESSIONID", "abc123")
    .httpOnly(true)
    .secure(true)
    .sameSite("Strict")
    .path("/")
    .maxAge(3600)
    .build();

return ResponseEntity.ok()
    .header(HttpHeaders.SET_COOKIE, cookie.toString())
    .body("OK");
```

Configura√ß√£o t√≠pica correta:
`HttpOnly; Secure; SameSite=Strict`

üî¥ Pentest cl√°ssico

Cookie sem HttpOnly ‚Üí XSS rouba sess√£o

Cookie sem SameSite ‚Üí CSRF vi√°vel

### X XSS-Protection

O header X-XSS-Protection √© uma medida de seguran√ßa que ajuda a proteger contra ataques de Cross-Site Scripting (XSS). Ele instrui o navegador a ativar ou desativar o filtro de XSS embutido, que pode detectar e bloquear scripts maliciosos.

Valor default:
  1 - Ativa o filtro de XSS.
  0 - Desativa o filtro de XSS.

## Exemplos

### Headers de Seguran√ßa ‚Äì Spring Boot

Essa √© a abordagem oficial e mais limpa.

```.java
@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http
            // Headers globais
            .headers(headers -> headers
                // HSTS
                .httpStrictTransportSecurity(hsts -> hsts
                    .includeSubDomains(true)
                    .preload(true)
                    .maxAgeInSeconds(31536000)
                )

                // Clickjacking
                .frameOptions(frame -> frame.deny())

                // MIME sniffing
                .contentTypeOptions(contentType -> {})

                // XSS (legado)
                .xssProtection(xss -> xss.block(true))

                // Referrer
                .referrerPolicy(referrer -> referrer
                    .policy(ReferrerPolicyHeaderWriter.ReferrerPolicy.NO_REFERRER)
                )

                // CSP
                .contentSecurityPolicy(csp -> csp
                    .policyDirectives(
                        "default-src 'self'; " +
                        "script-src 'self'; " +
                        "style-src 'self'; " +
                        "img-src 'self' data:; " +
                        "object-src 'none'; " +
                        "frame-ancestors 'none'"
                    )
                )
            )

            // Logout centralizado
            .logout(logout -> logout
                .logoutUrl("/logout")
                .invalidateHttpSession(true)
                .deleteCookies("JSESSIONID")
                .logoutSuccessHandler((request, response, authentication) -> {
                    response.setHeader(
                        "Clear-Site-Data",
                        "\"cache\", \"cookies\", \"storage\""
                    );
                    response.setStatus(HttpServletResponse.SC_NO_CONTENT);
                })
            );

        return http.build();
    }
}
```

√ötil quando:

Voc√™ quer aplicar headers condicionalmente
Diferenciar API / Admin / P√∫blico

```.java
@Component
public class GlobalSecurityHeadersFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(
            HttpServletRequest request,
            HttpServletResponse response,
            FilterChain filterChain
    ) throws ServletException, IOException {

        response.setHeader("X-Frame-Options", "DENY");
        response.setHeader("X-Content-Type-Options", "nosniff");
        response.setHeader("Referrer-Policy", "no-referrer");
        response.setHeader("Content-Security-Policy",
            "default-src 'self'; frame-ancestors 'none'"
        );

        // Logout-aware
        if ("/logout".equals(request.getRequestURI())) {
            response.setHeader(
                "Clear-Site-Data",
                "\"cache\", \"cookies\", \"storage\""
            );
        }

        filterChain.doFilter(request, response);
    }
}
```